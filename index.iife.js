this.VM=this.VM||{};(function(o){"use strict";const m=navigator.userAgent.includes("Macintosh"),_=["m","c","s","a"],y={ctrl:"c",control:"c",shift:"s",alt:"a",meta:"m",cmd:"m"},v={...y,c:"c",s:"s",a:"a",m:"m",cm:m?"m":"c",ctrlcmd:m?"m":"c"},S={c:"^",s:"⇧",a:"⌥",m:"⌘"},K={arrowup:"up",arrowdown:"down",arrowleft:"left",arrowright:"right",cr:"enter",escape:"esc"," ":"space"};function p(){return{children:new Map,shortcuts:new Set}}function q(s,e,i){let t=s;for(const r of e){let n=t.children.get(r);n||(n=p(),t.children.set(r,n)),t=n}t.shortcuts.add(i)}function M(s,e){let i=s;for(const t of e)if(i=i.children.get(t),!i)break;return i}function O(s,e,i){let t=s;const r=[t];for(const c of e){if(t=t.children.get(c),!t)return;r.push(t)}i?t.shortcuts.delete(i):t.shortcuts.clear();let n=r.length-1;for(;n>0&&(t=r[n],!(t.shortcuts.size||t.children.size));)r[n-1].children.delete(e[n-1]),n-=1}function T(s){const e=[],i=(t,r=0)=>{for(const[n,c]of t.children.entries())e.push(["  ".repeat(r),n,c.shortcuts.size?` (${c.shortcuts.size})`:""].join("")),i(c,r+1)};return i(s),e.join(`
`)}class j{constructor(e){this.value=e}listeners=[];get(){return this.value}set(e){this.value=e,this.listeners.forEach(i=>i(e))}subscribe(e){return this.listeners.push(e),e(this.value),()=>this.unsubscribe(e)}unsubscribe(e){const i=this.listeners.indexOf(e);i>=0&&this.listeners.splice(i,1)}}function a(s){const{caseSensitive:e,modifierState:i}=s;let{base:t}=s;(!e||t.length>1)&&(t=t.toLowerCase()),t=K[t]||t;const r=[..._.filter(n=>i[n]),t].filter(Boolean).join("-");return`${e?"":"i:"}${r}`}function D(s){const e=s.split(/-(.)/),i=[e[0]];for(let t=1;t<e.length;t+=2)i.push(e[t]+e[t+1]);return i}function b(s,e){const i=D(s),t=i.pop(),r={};for(const n of i){const c=v[n.toLowerCase()];if(!c)throw new Error(`Unknown modifier key: ${n}`);r[c]=!0}return e&&=!(r.a||r.s),{base:t,modifierState:r,caseSensitive:e}}function g(s){return Array.isArray(s)?s:s.split(/\s+/)}function w(s,e){return g(s).map(i=>b(i,e))}function C(s){return s.split("&&").map(e=>{if(e=e.trim(),!!e)return e[0]==="!"?{not:!0,field:e.slice(1).trim()}:{not:!1,field:e}}).filter(Boolean)}function k(s){const{modifierState:e,caseSensitive:i}=s;let{base:t}=s;return(!i||t.length>1)&&(t=t[0].toUpperCase()+t.slice(1)),[..._.filter(n=>e[n]).map(n=>S[n]),t].join("")}function z(s,e=!1){return g(s).map(i=>b(i,e)).map(i=>k(i)).join(" ")}const L="1.4.4";class u{_context={};_conditionData={};_data=[];_root=p();_cur;sequence=new j([]);_timer=0;static defaultOptions={sequenceTimeout:500};options;constructor(e){this.options={...u.defaultOptions,...e}}_reset=()=>{this._cur=void 0,this.sequence.set([]),this._resetTimer()};_resetTimer(){this._timer&&(window.clearTimeout(this._timer),this._timer=0)}_addCondition(e){let i=this._conditionData[e];if(!i){const t=C(e);i={count:0,value:t,result:this._evalCondition(t)},this._conditionData[e]=i}i.count+=1}_removeCondition(e){const i=this._conditionData[e];i&&(i.count-=1,i.count||delete this._conditionData[e])}_evalCondition(e){return e.every(i=>{let t=this._context[i.field];return i.not&&(t=!t),t})}_checkShortcut(e){const i=e.condition&&this._conditionData[e.condition],t=!i||i.result;e.enabled!==t&&(e.enabled=t,this._enableShortcut(e))}_enableShortcut(e){(e.enabled?q:O)(this._root,e.sequence,e)}enable(){this.disable(),document.addEventListener("keydown",this.handleKey)}disable(){document.removeEventListener("keydown",this.handleKey)}register(e,i,t){const{caseSensitive:r,condition:n}={caseSensitive:!1,...t},h={sequence:w(e,r).map(f=>a(f)),condition:n,callback:i,enabled:!1,caseSensitive:r};return n&&this._addCondition(n),this._checkShortcut(h),this._data.push(h),()=>{const f=this._data.indexOf(h);f>=0&&(this._data.splice(f,1),n&&this._removeCondition(n),h.enabled=!1,this._enableShortcut(h))}}setContext(e,i){this._context[e]=i;for(const t of Object.values(this._conditionData))t.result=this._evalCondition(t.value);for(const t of this._data)this._checkShortcut(t)}_handleKeyOnce(e,i){let t=this._cur;if((i||!t)&&(i=!0,t=this._root),t){let n;for(const c of e)if(n=M(t,[c]),n){this.sequence.set([...this.sequence.get(),c]);break}t=n}this._cur=t;const[r]=[...t?.shortcuts||[]];if(!i&&!r&&!t?.children.size)return this._reset(),this._handleKeyOnce(e,!0);if(r){try{r.callback()}catch{}return 2}return this._cur?1:0}handleKey=e=>{if(!e.key||y[e.key.toLowerCase()])return;this._resetTimer();const i=[a({base:e.key,modifierState:{c:e.ctrlKey,m:e.metaKey},caseSensitive:!0}),a({base:e.code,modifierState:{c:e.ctrlKey,s:e.shiftKey,a:e.altKey,m:e.metaKey},caseSensitive:!1}),a({base:e.key,modifierState:{c:e.ctrlKey,s:e.shiftKey,a:e.altKey,m:e.metaKey},caseSensitive:!1})],t=this._handleKeyOnce(i,!1);t&&(e.preventDefault(),t===2&&this._reset()),this._timer=window.setTimeout(this._reset,this.options.sequenceTimeout)};repr(){return T(this._root)}}let d;function l(){return d||(d=new u,d.enable()),d}const A=(...s)=>l().register(...s),E=()=>l().enable(),N=()=>l().disable(),V=(...s)=>l().handleKey(...s);o.KeyboardService=u,o.aliases=K,o.buildKey=a,o.disable=N,o.enable=E,o.getService=l,o.handleKey=V,o.isMacintosh=m,o.modifierAliases=v,o.modifierList=_,o.modifierSymbols=S,o.modifiers=y,o.normalizeSequence=w,o.parseCondition=C,o.parseKey=b,o.register=A,o.reprKey=k,o.reprShortcut=z,o.version=L,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})})(this.VM.shortcut=this.VM.shortcut||{});
//# sourceMappingURL=index.iife.js.map
